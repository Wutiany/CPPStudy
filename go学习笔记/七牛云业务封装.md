# 七牛云业务封装

# 1 各部分职能

## 1.1 服务端

* 生成凭证
* 将生成的**凭证和域名**下发给客户端
* 用关系型数据库保存**账号信息**，如果有多个云账号
* 使用数据库管理图片**元数据**和**资源**之间的关系
* 响应客户端请求，执行业务流程，返回结果

## 1.2 客户端

* 从**服务器**获取**元数据**信息
  * 不需要服务器获取图片，只需要**元数据信息**即可
  * 构造下载凭证：[下载凭证]([存储区域_产品简介_对象存储 - 七牛开发者中心 (qiniu.com)](https://developer.qiniu.com/kodo/1671/region-endpoint-fq))
* 使用**下载凭证**从七牛云获取待展示的内容
  * 压缩缩略图（公开资源）
  * 私有资源，需要购买或者其他的方式，下发凭证

# 2 业务流程

## 2.1  关键组成

**上传流程分为客户端上传和服务端上传**

* 七牛云存储服务
* 业务服务器：web 的后台服务器
* 客户端

## 2.2 业务流程

* **上传**
  * 客户端需要从**服务器**获取**上传凭证**
  
  * 上传的**域名与凭证**一起发给**客户端**
    * [各地域名]([存储区域_产品简介_对象存储 - 七牛开发者中心 (qiniu.com)](https://developer.qiniu.com/kodo/1671/region-endpoint-fq))
  
  * ![image-20240102133715004](../src/photo/image-20240102133715004.png)
  
  * 如果设置**回调**
  
    ![image-20240102133846987](../src/photo/image-20240102133846987.png)
  
* **下载**

  * 从服务器获取**下载凭证**，和**元数据**
  * 然后使用下载凭证向七牛云存储请求数据
  * 





* 安全凭证（生成凭证需要 SecretKey）
  * 上传资源：上传凭证（[上传凭证]()）
  * 访问资源：下载凭证
  * 管理和修改资源：管理凭证
* 