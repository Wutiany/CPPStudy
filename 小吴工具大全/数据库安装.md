# 数据库安装

## windows 下mysql安装

参考博客：[Windows MYSQL社区版8.1下载安装（MSI）_mysql社区版下载-CSDN博客](https://blog.csdn.net/weixin_68256171/article/details/132107858)

提示缺少 `Microsoft Visual Studio 2019 Redistributable`，参考博客：[MySQL msi安装缺少‘Microsoft Visual Studio 2019 Redistributable’_vstdio2019redistributable-CSDN博客](https://blog.csdn.net/qq_41563277/article/details/104665146)

[点击这里](https://visualstudio.microsoft.com/downloads/)

点击最底部：**Other Tools and Frameworks**一栏，
下载
**Microsoft Visual C++ Redistributable for Visual Studio 2019**

## Ubuntu 安装 Mysql

* 直接使用包管理安装

  ```shell
  $ sudo apt install mysql-server
  ```

* 服务未开启，使用以下命令开启

  ```shell
  $ sudo /etc/init.d/mysql start
  ```

* 查看版本

  ```shell
  $ mysql -V
  ```

* 初始化数据库

  ```shell
  $ mysql_secure_installation
  ```

* 调整用户身份验证

  * 检查用户对应的身份验证方法

    ```mysql
    SELECT user,authentication_string,plugin,host FROM mysql.user;
    ```

    ![image-20231012135054004](..\src\photo\image-20231012135054004.png)

  * 使用 'ALTER USER' 修身份验证方法

    ```mysql
    ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'your_password';
    ```

  * 修改完成后重新加载权限更新到数据库中

    ```mysql
    FLUSH PRIVILEGES;
    ```

  * 再次登陆时需要验证

    ```shell
    $ mysql -u root -p
    ```

* 创建新用户

  ```mysql
  CREATE USER 'wty'@'localhost' IDENTIFIED BY 'password';
  GRANT ALL PRIVILEGES ON *.* TO 'wty'@'localhost' WITH GRANT OPTION;
  ```

* **配置服务器远程连接**

  * 在防火墙打开一个端口

    ```shell
    $ sudo ufw enable
    $ sudo ufw allow mysql
    ```

  * 安装 ufw 工具

    ```shell
    $ sudo apt install ufw
    ```

  * 也可以为 mysql 打开端口（默认3306）

    ```shell
    $ sudo ufw allow 3306
    ```

  * 将 mysql 启动时运行

    ```shell
    $ sudo systemctl enable mysql
    ```

  * 配置接口（默认127.0.0.1:3306）

    ```shell
    $ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
    ```
    
  * 如果外部访问（暴漏公共接口）需要绑定外部接口
  
    ```shell
    $ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf
    ```
  
    修改 `bind-address` 成服务器的公开 `ip`
  
    会发生本地 `ip` 不被允许访问的问题；创建一个动态 ip 可以访问的用户
  
    ```mysql
    create user 'test'@'%' identified by 'wutianyu';  // '%' 动态ip，不限制ip
    grant all privileges on *.* to 'test'@'%'; // 授予权限
    flush privileges; // 刷新权限
    ```
  
    发生 `Public Key Retrieval is not allowed` 错误的时候，修改 mysql，使高版本服务器兼容低版本客户端，使用公钥检索（配置文件中修改）：**在设置中修改驱动属性**
  
    ![image-20231121170342090](..\src\photo\image-20231121170342090.png)

## Ubuntu 安装 Redis

### Redis images 使用

* 查看镜像：`docker search redis`
* 拉取镜像：`docker pull 镜像名:标签`

* 挂载本地目录
  * 创建本地存放 `redis` 配置文件的文件夹，同时在该文件夹中创建 `redis.conf` 作为 `redis` 启动时加载的配置文件
  * 挂在数据存放的文件夹，默认进入控制台的工作目录

* docker 容器创建

  ```shell
  $ docker run -d --name redis \
  	-p 6379:6379 \
  	--restart unless-stopped \ # 容器退出时自动重启，除非显示停止
  	-v D:\project\go_project\redis\data:/data \ # 工作目录挂载的位置
  	-v D:\project\go_project\redis\conf\:/etc/redis/ \ # 配置文件挂挂载的位置
  	redis \   # 镜像名
  	redis-server /etc/redis/redis.conf # 服务启动加载的配置文件
  
  ```

* 配置 `redis.conf` 

  ```
  appendonly yes #  启动Redis持久化功能 (默认 no , 所有信息都存储在内存 [重启丢失] 。 设置为 yes , 将存储在硬盘 [重启还在])
  requirepass 密码
  ```

* 进入 `redis` 容器中

  * ```shell
    $ docker exec -it redis /bin/bash
    $ redis-cli # 进入 redis 控制台
    $ redis-cli -h 127.0.0.1 -p 6379 -a 密码  # 如果设置了密码，需要登陆才能有权限写入
    ```


### Ubuntu 安装 Redis

* 命令安装

  ```shell
  $ sudo apt install redis-server
  ```

* 进入 `redis` 的远程配置（默认不可以使用远程）

  ```
  bind 0.0.0.0   # 修改成 0.0.0.0
  protected-mode no # 修改成 no ，yes是保护模式，只允许本地连接
  daemonize no  # 加入 daemonize no，后台启用一个不占用一个主程窗口
  ```

  

  



