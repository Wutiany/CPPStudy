# 小吴修仙传之生产环境篇

# Redis 篇

## 缓存一致性

### 解决方案

1. ==缓存失效==：**更新**数据库时，使缓存失效。保证**最终一致性**，但是失效的时候会产生**数据不一致**的情况。（最终一致，存在不一致空挡）（应用场景，保证数据最终一直，对短暂的不一致可以容忍）
2. ==缓存更新==：**更新**数据库时，同时更新缓存。保证**强一致性**，但是代码更加复杂，系统负载更高。（强一致，高负载）（应用场景，需要强一致实时更新的场景）
3. ==异步更新==：**更新**数据库时，异步更新缓存。保证系统可用性和性能（异步），同样会导致短暂的数据不一致（最终一致，低负载，高性能）（应用场景，需要**高性能系统**，同时对短暂不一致可以容忍）

### 实践方案

1. 选择合理缓存失效时间（被动更新）：业务不需要实时性，设置缓存失效，**定期**从数据库更新缓存
2. 使用分布式锁：数据库缓存更新时，使用分布式锁（获取锁，检查缓存，获取数据库数据，更新缓存，释放分布式锁）避免并发导致的数据不一致
3. 定期同步缓存和数据库（主动更新）
4. 采用合理的缓存策略（缓存失效、缓存更新、异步更新等）
5. 使用分布式事务：在进行数据库和缓存的更新操作时，使用分布式事务来保证数据的一致性和可靠性
6. 监控和警告：对 redis 缓存系统进行监控和警告

### 缓存一致模型

#### Memcached（旁路缓存）

![小吴的MIT6.824学习笔记/分布式论文及阅读/memcached](../src/photo/image-20240226200625093.png)

